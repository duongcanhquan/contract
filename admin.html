<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR ADMIN SYSTEM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f0f2f5; font-family: 'Roboto', sans-serif; }
        .hidden { display: none !important; }
        .login-wrapper { height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #0056b3, #003d80); }
        .card-login { width: 100%; max-width: 400px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        /* Giao di·ªán Form Admin gi·ªëng Index.html */
        .main-container { max-width: 960px; margin: 20px auto; background: white; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        .header-banner { background: white; padding: 20px; text-align: center; border-bottom: 3px solid #0056b3; }
        .section-header { background-color: #e3f2fd; color: #0d47a1; padding: 10px 15px; border-radius: 8px; font-weight: 700; margin-top: 25px; margin-bottom: 15px; border-left: 5px solid #0d47a1; }
        
        /* Ph·∫ßn ri√™ng cho Admin */
        .admin-section { background-color: #fff3cd; border: 2px solid #ffc107; }
        .admin-header { background-color: #ffc107; color: #000; border-left: 5px solid #d39e00; }
        
        /* Search Box g·ª£i √Ω */
        .search-container { position: relative; margin-bottom: 30px; }
        #suggestion-box { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; z-index: 1000; max-height: 300px; overflow-y: auto; display: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .suggestion-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        .suggestion-item:hover { background-color: #f0f8ff; }
    </style>
</head>
<body>

    <div id="loginScreen" class="login-wrapper">
        <div class="card card-login p-4 bg-white">
            <div class="text-center mb-4">
                <h3 class="fw-bold text-primary">HR ADMIN LOGIN</h3>
                <small class="text-muted">H·ªá th·ªëng qu·∫£n tr·ªã nh√¢n s·ª±</small>
            </div>
            <div class="mb-3">
                <label class="fw-bold">T√†i kho·∫£n</label>
                <input type="text" id="adminUser" class="form-control" placeholder="Username">
            </div>
            <div class="mb-4">
                <label class="fw-bold">M·∫≠t kh·∫©u</label>
                <input type="password" id="adminPass" class="form-control" placeholder="Password">
            </div>
            <button class="btn btn-primary w-100 py-2 fw-bold" onclick="login()">ƒêƒÇNG NH·∫¨P</button>
        </div>
    </div>

    <div id="dashboard" class="main-container hidden">
        
        <div class="header-banner position-relative">
            <button class="btn btn-sm btn-outline-danger position-absolute top-0 end-0 m-3" onclick="logout()">ƒêƒÉng xu·∫•t</button>
            <h2 class="text-danger fw-bold">TRANG QU·∫¢N TR·ªä ADMIN</h2>
            <p class="mb-0">T√¨m ki·∫øm - Ch·ªânh s·ª≠a - T·∫°o h·ª£p ƒë·ªìng</p>
        </div>

        <div class="p-4">
            <div class="search-container">
                <label class="form-label fw-bold text-primary">üîç T√¨m nh√¢n s·ª± (G√µ T√™n ho·∫∑c CCCD):</label>
                <input type="text" id="searchKeyword" class="form-control form-control-lg border-primary" 
                       placeholder="G√µ v√†o ƒë√¢y ƒë·ªÉ t√¨m..." onkeyup="handleTyping()" autocomplete="off">
                <div id="suggestion-box"></div>
                <div id="loadingSearch" class="small text-muted mt-1 hidden">Drafting...</div>
            </div>

            <form id="adminForm" class="hidden">
                <input type="hidden" id="rowIndex">
                <input type="hidden" id="folderUrl">

                <div class="section-header">1. Th√¥ng tin c√° nh√¢n (C√≥ th·ªÉ s·ª≠a)</div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">H·ªç v√† t√™n</label>
                        <input type="text" class="form-control fw-bold" id="ho_ten" style="text-transform: uppercase;">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Gi·ªõi t√≠nh</label>
                        <select class="form-select" id="gioi_tinh">
                            <option value="Nam">Nam</option>
                            <option value="N·ªØ">N·ªØ</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Qu·ªëc t·ªãch</label>
                        <input type="text" class="form-control" id="quoc_tich">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Ng√†y sinh</label>
                        <input type="date" class="form-control" id="ngay_sinh">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                        <input type="text" class="form-control" id="so_dien_thoai">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email</label>
                        <input type="text" class="form-control" id="email">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">T√¨nh tr·∫°ng h√¥n nh√¢n</label>
                        <select class="form-select" id="hon_nhan">
                            <option value="ƒê·ªôc th√¢n">ƒê·ªôc th√¢n</option>
                            <option value="ƒê√£ k·∫øt h√¥n">ƒê√£ k·∫øt h√¥n</option>
                            <option value="Ly h√¥n">Ly h√¥n</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫</label>
                        <input type="text" class="form-control" id="dia_chi_thuong_tru">
                    </div>
                </div>

                <div class="section-header">2. Gi·∫•y t·ªù t√πy th√¢n</div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label text-danger fw-bold">S·ªë CCCD (Key ID)</label>
                        <input type="text" class="form-control border-danger" id="so_cccd">
                    </div>
                    </div>

                <div class="section-header admin-header mt-5">‚òÖ 7. TH√îNG TIN H·ª¢P ƒê·ªíNG (ADMIN ƒêI·ªÄN)</div>
                <div class="admin-section p-3 rounded">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Lo·∫°i h·ª£p ƒë·ªìng</label>
                            <select id="loai_hop_dong_admin" class="form-select border-warning">
                                <option value="">-- Ch·ªçn --</option>
                                <option value="H·ª£p ƒë·ªìng th·ª≠ vi·ªác">H·ª£p ƒë·ªìng th·ª≠ vi·ªác</option>
                                <option value="H·ª£p ƒë·ªìng ch√≠nh th·ª©c">H·ª£p ƒë·ªìng ch√≠nh th·ª©c</option>
                                <option value="H·ª£p ƒë·ªìng th·ªânh gi·∫£ng">H·ª£p ƒë·ªìng th·ªânh gi·∫£ng</option>
                                <option value="H·ª£p ƒë·ªìng d·ªãch v·ª•">H·ª£p ƒë·ªìng d·ªãch v·ª•</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">M·ª©c l∆∞∆°ng / Ph√≠ (VNƒê)</label>
                            <input type="text" id="muc_luong" class="form-control border-warning fw-bold text-danger" placeholder="VD: 10,000,000">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Ng√†y b·∫Øt ƒë·∫ßu</label>
                            <input type="date" id="ngay_bat_dau" class="form-control border-warning">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Ng√†y k·∫øt th√∫c</label>
                            <input type="date" id="ngay_ket_thuc" class="form-control border-warning">
                        </div>
                    </div>
                </div>

                <div class="mt-4 pt-3 border-top text-center">
                    <button type="button" id="btnUpdate" class="btn btn-success btn-lg px-5 fw-bold" onclick="submitUpdate()">
                        üíæ L∆ØU THAY ƒê·ªîI & T·∫†O H·ª¢P ƒê·ªíNG
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // LINK APP SCRIPT C·ª¶A B·∫†N
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyZlPxiPf4zPFCkYZuu9SFWDzNhcVo36pcuU7mxXtgy7ZFFa7P4mLcGg3fMn0LJfRudTQ/exec";
        
        // LOGIN LOGIC
        function login() {
            const u = document.getElementById('adminUser').value;
            const p = document.getElementById('adminPass').value;
            if(u === 'hradmin' && p === 'vietmy@1221') {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
            } else {
                alert('Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!');
            }
        }
        function logout() { location.reload(); }

        // SEARCH LOGIC
        let timeout = null;
        function handleTyping() {
            const k = document.getElementById('searchKeyword').value;
            if(timeout) clearTimeout(timeout);
            if(k.length < 2) { document.getElementById('suggestion-box').style.display='none'; return; }
            
            timeout = setTimeout(() => {
                document.getElementById('loadingSearch').classList.remove('hidden');
                fetch(SCRIPT_URL, {
                    method: 'POST', redirect: 'follow', headers: {'Content-Type': 'text/plain;charset=utf-8'},
                    body: JSON.stringify({ action: 'SEARCH_CANDIDATE', keyword: k })
                }).then(r=>r.json()).then(data => {
                    document.getElementById('loadingSearch').classList.add('hidden');
                    const box = document.getElementById('suggestion-box');
                    box.innerHTML = '';
                    if(data.status === 'SUCCESS') {
                        box.style.display = 'block';
                        data.message.forEach(u => {
                            const div = document.createElement('div');
                            div.className = 'suggestion-item';
                            div.innerHTML = `<b>${u.ho_ten}</b> - ${u.so_cccd}`;
                            div.onclick = () => fillForm(u);
                            box.appendChild(div);
                        });
                    } else {
                        box.style.display = 'block'; box.innerHTML = '<div class="p-2 text-muted">Kh√¥ng t√¨m th·∫•y</div>';
                    }
                });
            }, 500);
        }

        // FILL DATA TO FORM
        function fillForm(u) {
            document.getElementById('suggestion-box').style.display = 'none';
            document.getElementById('adminForm').classList.remove('hidden');
            
            // ƒêi·ªÅn d·ªØ li·ªáu v√†o c√°c √¥ (N·∫øu ID kh·ªõp)
            document.getElementById('rowIndex').value = u.rowIndex;
            document.getElementById('folderUrl').value = u.folderUrl;
            
            document.getElementById('ho_ten').value = u.ho_ten;
            document.getElementById('so_cccd').value = u.so_cccd;
            document.getElementById('email').value = u.email;
            document.getElementById('so_dien_thoai').value = u.so_dien_thoai;
            document.getElementById('gioi_tinh').value = u.gioi_tinh || 'Nam';
            document.getElementById('quoc_tich').value = u.quoc_tich || 'Vi·ªát Nam';
            document.getElementById('ngay_sinh').value = u.ngay_sinh || '';
            document.getElementById('dia_chi_thuong_tru').value = u.dia_chi || '';
            
            // ƒêi·ªÅn d·ªØ li·ªáu Admin c≈© (n·∫øu c√≥)
            document.getElementById('loai_hop_dong_admin').value = u.loai_hop_dong_admin || '';
            document.getElementById('muc_luong').value = u.muc_luong || '';
            document.getElementById('ngay_bat_dau').value = u.ngay_bat_dau || '';
            document.getElementById('ngay_ket_thuc').value = u.ngay_ket_thuc || '';
        }

        // SUBMIT UPDATE
        function submitUpdate() {
            if(!confirm("X√°c nh·∫≠n c·∫≠p nh·∫≠t th√¥ng tin v√† t·∫°o h·ª£p ƒë·ªìng?")) return;
            
            const btn = document.getElementById('btnUpdate');
            btn.innerHTML = 'ƒêang x·ª≠ l√Ω...'; btn.disabled = true;

            const payload = {
                rowIndex: document.getElementById('rowIndex').value,
                folderUrl: document.getElementById('folderUrl').value,
                // L·∫•y d·ªØ li·ªáu t·ª´ form (bao g·ªìm c·∫£ data s·ª≠a ƒë·ªïi)
                ho_ten: document.getElementById('ho_ten').value,
                so_cccd: document.getElementById('so_cccd').value,
                gioi_tinh: document.getElementById('gioi_tinh').value,
                quoc_tich: document.getElementById('quoc_tich').value,
                so_dien_thoai: document.getElementById('so_dien_thoai').value,
                hon_nhan: document.getElementById('hon_nhan').value,
                email: document.getElementById('email').value,
                ngay_sinh: document.getElementById('ngay_sinh').value,
                dia_chi_thuong_tru: document.getElementById('dia_chi_thuong_tru').value,
                
                // Data Admin
                loai_hop_dong_admin: document.getElementById('loai_hop_dong_admin').value,
                muc_luong: document.getElementById('muc_luong').value,
                ngay_bat_dau: document.getElementById('ngay_bat_dau').value,
                ngay_ket_thuc: document.getElementById('ngay_ket_thuc').value
            };

            fetch(SCRIPT_URL, {
                method: 'POST', redirect: 'follow', headers: {'Content-Type': 'text/plain;charset=utf-8'},
                body: JSON.stringify({ action: 'UPDATE_CONTRACT', payload: payload })
            }).then(r=>r.json()).then(data => {
                alert('‚úÖ ' + data.message);
                location.reload();
            }).catch(e => {
                alert('L·ªói: ' + e); btn.disabled = false; btn.innerHTML = 'üíæ L∆ØU THAY ƒê·ªîI & T·∫†O H·ª¢P ƒê·ªíNG';
            });
        }
    </script>
</body>
</html>
