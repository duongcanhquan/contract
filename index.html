<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HỆ THỐNG NỘP HỒ SƠ NHÂN SỰ - APCHN</title>
    <link rel="icon" href="https://raw.githubusercontent.com/duongcanhquan/image/main/logo%20vietmy.webp">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary-color: #0056b3; --secondary-color: #f0f2f5; }
        body { background-color: var(--secondary-color); font-family: 'Roboto', sans-serif; padding-bottom: 40px; }
        
        .main-container {
            max-width: 900px;
            margin: 30px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header-banner {
            background: white;
            padding: 30px 20px;
            text-align: center;
            border-bottom: 4px solid var(--primary-color);
        }

        .logo-img { max-height: 80px; margin-bottom: 15px; }
        .page-title { color: #d32f2f; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin: 0; }
        .page-subtitle { color: #555; font-size: 0.95rem; margin-top: 5px; }

        /* Section Styling */
        .form-section { padding: 30px; border-bottom: 1px solid #eee; }
        .section-title {
            color: var(--primary-color);
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 20px;
            display: flex; align-items: center; gap: 10px;
            font-size: 1.1rem;
        }
        .section-title i { font-size: 1.3rem; }

        .form-label { font-weight: 500; color: #333; font-size: 0.95rem; }
        .form-control, .form-select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ced4da;
            transition: all 0.3s;
        }
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.15);
        }

        /* Button */
        .btn-submit {
            background: linear-gradient(45deg, #0056b3, #004494);
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            padding: 15px 40px;
            border-radius: 50px;
            border: none;
            box-shadow: 0 4px 15px rgba(0, 86, 179, 0.3);
            transition: all 0.3s;
            width: 100%;
        }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 86, 179, 0.5); }
        .btn-submit:disabled { background: #ccc; transform: none; box-shadow: none; cursor: not-allowed; }

        /* Footer Link */
        .admin-link a { color: #999; font-size: 0.8rem; text-decoration: none; transition: 0.3s; }
        .admin-link a:hover { color: var(--primary-color); text-decoration: underline; }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="header-banner">
            <img src="https://raw.githubusercontent.com/duongcanhquan/image/main/logo%20vietmy.webp" alt="Logo" class="logo-img">
            <h2 class="page-title">Phiếu Thông Tin Nhân Sự</h2>
            <p class="page-subtitle">Candidate Information Form</p>
        </div>

        <form id="hrForm" onsubmit="submitForm(event)">
            
            <div class="form-section">
                <div class="section-title"><i class="bi bi-person-lines-fill"></i> 1. Thông tin cá nhân / Personal Information</div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Họ và tên / Full Name <span class="text-danger">*</span></label>
                        <input type="text" id="ho_ten" class="form-control" required style="text-transform: uppercase;" placeholder="NGUYEN VAN A">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Giới tính / Gender <span class="text-danger">*</span></label>
                        <select id="gioi_tinh" class="form-select" required>
                            <option value="">-- Chọn --</option>
                            <option value="Nam">Nam / Male</option>
                            <option value="Nữ">Nữ / Female</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Quốc tịch / Nationality</label>
                        <input type="text" id="quoc_tich" class="form-control" value="Việt Nam">
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Ngày sinh / Date of Birth <span class="text-danger">*</span></label>
                        <input type="date" id="ngay_sinh" class="form-control" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Nơi sinh / Place of Birth <span class="text-danger">*</span></label>
                        <input type="text" id="noi_sinh" class="form-control" required placeholder="Tỉnh/Thành phố...">
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Số điện thoại / Phone <span class="text-danger">*</span></label>
                        <input type="tel" id="so_dien_thoai" class="form-control" required placeholder="09xxxxxxx">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email cá nhân / Email <span class="text-danger">*</span></label>
                        <input type="email" id="email" class="form-control" required placeholder="example@gmail.com">
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Tình trạng hôn nhân / Marital Status</label>
                        <select id="hon_nhan" class="form-select">
                            <option value="Độc thân">Độc thân / Single</option>
                            <option value="Đã kết hôn">Đã kết hôn / Married</option>
                            <option value="Ly hôn">Ly hôn / Divorced</option>
                        </select>
                    </div>

                    <div class="col-12">
                        <label class="form-label">Địa chỉ thường trú / Permanent Address <span class="text-danger">*</span></label>
                        <input type="text" id="dia_chi_thuong_tru" class="form-control" required placeholder="Theo sổ hộ khẩu / As per ID card">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Nơi ở hiện tại / Current Address <span class="text-danger">*</span></label>
                        <input type="text" id="noi_o_hien_tai" class="form-control" required>
                    </div>
                </div>
            </div>

            <div class="form-section bg-light">
                <div class="section-title"><i class="bi bi-card-heading"></i> 2. Giấy tờ tùy thân / Identity</div>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Số CCCD / ID Number <span class="text-danger">*</span></label>
                        <input type="text" id="so_cccd" class="form-control fw-bold" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Ngày cấp / Date of Issue <span class="text-danger">*</span></label>
                        <input type="date" id="ngay_cap_cccd" class="form-control" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Nơi cấp / Place of Issue <span class="text-danger">*</span></label>
                        <input type="text" id="noi_cap_cccd" class="form-control" required placeholder="Cục CS QLHC...">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-title"><i class="bi bi-mortarboard"></i> 3. Trình độ học vấn / Education</div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Trình độ cao nhất / Highest Degree <span class="text-danger">*</span></label>
                        <select id="trinh_do" class="form-select" required>
                            <option value="">-- Chọn / Select --</option>
                            <option value="Tiến sĩ">Tiến sĩ / PhD</option>
                            <option value="Thạc sĩ">Thạc sĩ / Master</option>
                            <option value="Đại học">Đại học / Bachelor</option>
                            <option value="Cao đẳng">Cao đẳng / College</option>
                            <option value="Trung cấp">Trung cấp / Intermediate</option>
                            <option value="THPT">THPT / High School</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Chuyên ngành / Major</label>
                        <input type="text" id="chuyen_nganh" class="form-control">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Nơi đào tạo / School or University</label>
                        <input type="text" id="truong_dao_tao" class="form-control">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Chứng chỉ khác / Other Certificates</label>
                        <input type="text" id="bang_cap_khac" class="form-control" placeholder="IELTS, TOEIC, CPA...">
                    </div>
                </div>
            </div>

            <div class="form-section bg-light">
                <div class="section-title"><i class="bi bi-bank"></i> 4. Tài chính & Thuế / Finance & Tax</div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Ngân hàng / Bank Name <span class="text-danger">*</span></label>
                        <input type="text" id="chi_nhanh_ngan_hang" class="form-control" required placeholder="Vietcombank, Techcombank...">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Số tài khoản / Account No <span class="text-danger">*</span></label>
                        <input type="text" id="so_tk_ngan_hang" class="form-control fw-bold" required>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Tên chủ tài khoản / Account Name <span class="text-danger">*</span></label>
                        <input type="text" id="ten_tk_ngan_hang" class="form-control" required style="text-transform: uppercase;">
                        <div class="form-text">Phải trùng với tên người nộp hồ sơ / Must match applicant's name.</div>
                    </div>
                    
                    <hr class="my-3">
                    
                    <div class="col-md-4">
                        <label class="form-label">Mã số thuế / Tax Code <span class="text-danger">*</span></label>
                        <input type="text" id="mst_ca_nhan" class="form-control" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Ngày cấp MST / Tax Date</label>
                        <input type="date" id="ngay_cap_mst" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Nơi cấp MST / Tax Place</label>
                        <input type="text" id="noi_cap_mst" class="form-control">
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label">Số sổ BHXH / Social Insurance No</label>
                        <input type="text" id="so_bhxh" class="form-control" placeholder="Nếu có / If any">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-title"><i class="bi bi-people"></i> 5. Gia đình / Family (Children)</div>
                <p class="text-muted small">Thông tin con cái (Họ tên - Năm sinh) / Children info (Name - YOB)</p>
                <div class="row g-3">
                    <div class="col-12"><input type="text" id="con_1" class="form-control" placeholder="Con thứ 1 / Child 1"></div>
                    <div class="col-12"><input type="text" id="con_2" class="form-control" placeholder="Con thứ 2 / Child 2"></div>
                    <div class="col-12"><input type="text" id="con_3" class="form-control" placeholder="Con thứ 3 / Child 3"></div>
                </div>

                <div class="mt-4">
                    <label class="form-label fw-bold">Người phụ thuộc (Giảm trừ gia cảnh) / Dependents</label>
                    <div class="p-3 bg-light rounded border mb-2">
                        <label class="small fw-bold">Người 1:</label>
                        <div class="row g-2">
                            <div class="col-md-4"><input type="text" id="npt_1_ten" class="form-control form-control-sm" placeholder="Họ tên / Name"></div>
                            <div class="col-md-4"><input type="text" id="npt_1_mst" class="form-control form-control-sm" placeholder="Mã số thuế / Tax Code"></div>
                            <div class="col-md-4"><input type="text" id="npt_1_qh" class="form-control form-control-sm" placeholder="Quan hệ / Relation"></div>
                        </div>
                    </div>
                    <div class="p-3 bg-light rounded border">
                        <label class="small fw-bold">Người 2:</label>
                        <div class="row g-2">
                            <div class="col-md-4"><input type="text" id="npt_2_ten" class="form-control form-control-sm" placeholder="Họ tên / Name"></div>
                            <div class="col-md-4"><input type="text" id="npt_2_mst" class="form-control form-control-sm" placeholder="Mã số thuế / Tax Code"></div>
                            <div class="col-md-4"><input type="text" id="npt_2_qh" class="form-control form-control-sm" placeholder="Quan hệ / Relation"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section bg-light">
                <div class="section-title"><i class="bi bi-telephone-plus"></i> 6. Liên hệ khẩn cấp / Emergency Contact</div>
                <div class="col-12">
                    <label class="form-label">Họ tên - Quan hệ - SĐT <span class="text-danger">*</span></label>
                    <input type="text" id="lien_he_khan_cap" class="form-control" required placeholder="VD: Nguyen Van B - Bố - 0987...">
                </div>
            </div>

            <div class="form-section">
                <div class="section-title"><i class="bi bi-briefcase"></i> 7. Thông tin công việc / Job Info</div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Loại hợp đồng / Contract Type <span class="text-danger">*</span></label>
                        <select id="loai_hop_dong" class="form-select" required>
                            <option value="">-- Chọn / Select --</option>
                            <option value="Hợp đồng dịch vụ">Hợp đồng dịch vụ / Service</option>
                            <option value="Hợp đồng thỉnh giảng">Hợp đồng thỉnh giảng / Visiting</option>
                            <option value="Hợp đồng thử việc">Hợp đồng thử việc / Probation</option>
                            <option value="Hợp đồng chính thức">Hợp đồng chính thức / Official</option>
                            <option value="Khác">Khác / Other</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Phòng ban / Department <span class="text-danger">*</span></label>
                        <select id="phong_ban" class="form-select" required>
                            <option value="">-- Chọn / Select --</option>
                            <option value="Đào tạo">Phòng Đào tạo / Training Dept</option>
                            <option value="Hành chính - Nhân sự">HC-NS / HR-Admin</option>
                            <option value="Kế toán">Kế toán / Accounting</option>
                            <option value="Tuyển sinh">Tuyển sinh / Admission</option>
                            <option value="Công tác HSSV">CT HSSV / Student Affairs</option>
                            <option value="Khác">Khác / Other</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section bg-light">
                <div class="section-title"><i class="bi bi-cloud-upload"></i> 8. Tải lên hồ sơ / Upload Documents</div>
                <div class="alert alert-info small">
                    <i class="bi bi-info-circle"></i> Vui lòng tải lên ảnh chụp <strong>CCCD (2 mặt)</strong> và các bằng cấp liên quan.<br>
                    Please upload photos of <strong>ID Card (both sides)</strong> and degrees.
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Ảnh CCCD 2 mặt và hồ sơ (Tối đa 5 ảnh / Max 5) <span class="text-danger">*</span></label>
                    <input type="file" id="fileInput" class="form-control" multiple accept="image/*,application/pdf" required>
                    <div id="fileList" class="mt-2 text-muted small fst-italic"></div>
                </div>
            </div>

            <div class="p-4">
                <button type="submit" id="btnSubmit" class="btn-submit">
                    <i class="bi bi-send-fill"></i> GỬI HỒ SƠ / SUBMIT
                </button>
            </div>

        </form>
        
        <div class="text-center pb-4 admin-link">
            <a href="./admin.html"><i class="bi bi-shield-lock"></i> Admin Portal</a>
        </div>
    </div>

    <script>
        // ============================================================
        // HÃY DÁN LINK WEB APP CỦA BẠN VÀO DÒNG DƯỚI ĐÂY
        // ============================================================
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzZsJvb600lQLg5oaxxxH5tBz_xlMt4JQKObLq-aNGFntbEmgFAVQn6v7LeThdVn21zOA/exec"; 
        // ============================================================

        const fileInput = document.getElementById('fileInput');
        const fileListDisplay = document.getElementById('fileList');
        let selectedFiles = [];

        // Xử lý hiển thị tên file khi chọn
        fileInput.addEventListener('change', () => {
            fileListDisplay.innerHTML = '';
            selectedFiles = Array.from(fileInput.files);
            
            if (selectedFiles.length > 5) {
                alert("Bạn chỉ được chọn tối đa 5 file! / Max 5 files only!");
                fileInput.value = ''; 
                selectedFiles = [];
                return;
            }

            selectedFiles.forEach(file => {
                fileListDisplay.innerHTML += `<div><i class="bi bi-check-circle-fill text-success"></i> ${file.name}</div>`;
            });
        });

        function submitForm(e) {
            e.preventDefault();
            
            if(!confirm("Xác nhận gửi thông tin? / Confirm submit?")) return;

            const btn = document.getElementById('btnSubmit');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Đang xử lý / Processing...';
            btn.disabled = true;

            // 1. Thu thập dữ liệu Form
            const formData = {
                ho_ten: document.getElementById('ho_ten').value,
                gioi_tinh: document.getElementById('gioi_tinh').value,
                quoc_tich: document.getElementById('quoc_tich').value,
                ngay_sinh: document.getElementById('ngay_sinh').value,
                noi_sinh: document.getElementById('noi_sinh').value,
                so_dien_thoai: document.getElementById('so_dien_thoai').value,
                email: document.getElementById('email').value,
                hon_nhan: document.getElementById('hon_nhan').value,
                dia_chi_thuong_tru: document.getElementById('dia_chi_thuong_tru').value,
                noi_o_hien_tai: document.getElementById('noi_o_hien_tai').value,
                
                so_cccd: document.getElementById('so_cccd').value,
                ngay_cap_cccd: document.getElementById('ngay_cap_cccd').value,
                noi_cap_cccd: document.getElementById('noi_cap_cccd').value,
                
                trinh_do: document.getElementById('trinh_do').value,
                chuyen_nganh: document.getElementById('chuyen_nganh').value,
                truong_dao_tao: document.getElementById('truong_dao_tao').value,
                bang_cap_khac: document.getElementById('bang_cap_khac').value,
                
                ten_tk_ngan_hang: document.getElementById('ten_tk_ngan_hang').value,
                so_tk_ngan_hang: document.getElementById('so_tk_ngan_hang').value,
                chi_nhanh_ngan_hang: document.getElementById('chi_nhanh_ngan_hang').value,
                mst_ca_nhan: document.getElementById('mst_ca_nhan').value,
                ngay_cap_mst: document.getElementById('ngay_cap_mst').value,
                noi_cap_mst: document.getElementById('noi_cap_mst').value,
                so_bhxh: document.getElementById('so_bhxh').value,
                
                con_1: document.getElementById('con_1').value,
                con_2: document.getElementById('con_2').value,
                con_3: document.getElementById('con_3').value,
                
                npt_1_ten: document.getElementById('npt_1_ten').value,
                npt_1_mst: document.getElementById('npt_1_mst').value,
                npt_1_qh: document.getElementById('npt_1_qh').value,
                npt_2_ten: document.getElementById('npt_2_ten').value,
                npt_2_mst: document.getElementById('npt_2_mst').value,
                npt_2_qh: document.getElementById('npt_2_qh').value,
                
                lien_he_khan_cap: document.getElementById('lien_he_khan_cap').value,
                loai_hop_dong: document.getElementById('loai_hop_dong').value,
                phong_ban: document.getElementById('phong_ban').value
            };

            // 2. Gửi thông tin (SAVE_INFO)
            fetch(SCRIPT_URL, {
                method: "POST",
                redirect: "follow",
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify({ action: "SAVE_INFO", payload: formData })
            })
            .then(res => res.json())
            .then(response => {
                if (response.status === 'SUCCESS') {
                    const folderId = response.message.folderId; // Lấy ID folder vừa tạo
                    
                    // 3. Nếu có file thì Upload tiếp
                    if (selectedFiles.length > 0) {
                        uploadFilesSequentially(selectedFiles, folderId, () => {
                            alert("✅ GỬI HỒ SƠ THÀNH CÔNG! \nSuccessfully Submitted!");
                            document.getElementById('hrForm').reset();
                            fileListDisplay.innerHTML = '';
                            btn.disabled = false;
                            btn.innerHTML = originalText;
                        });
                    } else {
                        alert("✅ GỬI THÀNH CÔNG (Không có file)!");
                        document.getElementById('hrForm').reset();
                        btn.disabled = false;
                        btn.innerHTML = originalText;
                    }
                } else {
                    throw new Error(response.message);
                }
            })
            .catch(error => {
                alert("LỖI / ERROR: " + error);
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        }

        // Hàm upload file tuần tự
        async function uploadFilesSequentially(files, folderId, onComplete) {
            let uploadedCount = 0;
            const btn = document.getElementById('btnSubmit');
            
            for (let i = 0; i < files.length; i++) {
                btn.innerHTML = `Uploading file ${i+1}/${files.length}...`;
                const file = files[i];
                const reader = new FileReader();
                
                await new Promise((resolve, reject) => {
                    reader.onload = function(e) {
                        const base64Data = e.target.result; // Data URL
                        
                        fetch(SCRIPT_URL, {
                            method: "POST",
                            redirect: "follow",
                            headers: { "Content-Type": "text/plain;charset=utf-8" },
                            body: JSON.stringify({
                                action: "UPLOAD_FILE",
                                payload: {
                                    folderId: folderId,
                                    fileName: file.name,
                                    dataStr: base64Data
                                }
                            })
                        })
                        .then(() => resolve())
                        .catch(err => reject(err));
                    };
                    reader.readAsDataURL(file);
                });
            }
            onComplete();
        }
    </script>
</body>
</html>
