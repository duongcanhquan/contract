<!DOCTYPE html>
<html lang="vi">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THÔNG TIN NHÂN SỰ / HR PROFILE - APCHN</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #0056b3; 
            --bg-color: #f0f2f5;
            --card-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }

        body { 
            background-color: var(--bg-color); 
            font-family: 'Roboto', sans-serif; 
            color: #333;
            padding-bottom: 40px;
        }

        .main-container {
            max-width: 960px;
            margin: 20px auto;
            background: white;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }

        /* Header Logo Section */
        .header-banner {
            background: white;
            padding: 30px 20px;
            text-align: center;
            border-bottom: 3px solid var(--primary-color);
        }

        .logo-img {
            max-width: 300px;
            height: auto;
            margin-bottom: 10px;
            display: inline-block;
        }

        .form-title {
            color: #b71c1c;
            font-weight: 700;
            font-size: 1.6rem;
            text-transform: uppercase;
            margin-bottom: 0;
            margin-top: 10px;
        }

        /* Form Styling */
        .form-padding {
            padding: 30px;
        }

        .section-header {
            background-color: #e3f2fd;
            color: #0d47a1;
            padding: 12px 15px;
            border-radius: 8px;
            font-weight: 700;
            margin-top: 25px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            border-left: 5px solid #0d47a1;
        }

        .form-label {
            font-weight: 500;
            font-size: 0.95rem;
            color: #495057;
            margin-bottom: 5px;
        }

        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            transition: all 0.3s;
        }

        .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.25);
            border-color: #0d47a1;
        }

        /* Nút Gửi */
        .btn-submit-wrapper {
            margin-top: 40px;
            margin-bottom: 20px;
        }

        .btn-submit {
            background: linear-gradient(45deg, #0d47a1, #1976d2);
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            width: 100%;
            box-shadow: 0 4px 15px rgba(13, 71, 161, 0.4);
            transition: transform 0.2s;
            color: white;
        }

        .btn-submit:active {
            transform: scale(0.98);
        }

        /* Mobile Optimization */
        @media (max-width: 576px) {
            .main-container {
                margin: 0;
                border-radius: 0;
                box-shadow: none;
            }
            .form-padding {
                padding: 20px 15px;
            }
            .logo-img {
                max-width: 200px;
            }
            .form-title {
                font-size: 1.3rem;
            }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.95);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="header-banner">
            <img src="https://raw.githubusercontent.com/duongcanhquan/image/main/logo%20vietmy.webp" alt="Logo Viet My" class="logo-img">
            <h1 class="form-title">THÔNG TIN NHÂN SỰ / HR PROFILE</h1>
            <p class="text-muted mt-2 mb-0">Hệ thống quản lý hồ sơ tập trung / Centralized Profile Management System</p>
        </div>

        <div class="form-padding">
            <form id="hrForm" autocomplete="off">
                
                <div class="section-header">1. Thông tin cá nhân / Personal Info</div>
                <div class="row g-3">
                    <div class="col-12 col-md-6">
                        <label class="form-label">Họ và tên / Full Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" name="ho_ten" placeholder="NHẬP CHỮ IN HOA / UPPERCASE..." required style="text-transform: uppercase;">
                    </div>
                    <div class="col-6 col-md-3">
                        <label class="form-label">Giới tính / Gender <span class="text-danger">*</span></label>
                        <select class="form-select" name="gioi_tinh" required>
                            <option value="">--Chọn/Select--</option>
                            <option value="Nam">Nam / Male</option>
                            <option value="Nữ">Nữ / Female</option>
                        </select>
                    </div>
                    <div class="col-6 col-md-3">
                        <label class="form-label">Quốc tịch / Nationality</label>
                        <input type="text" class="form-control" name="quoc_tich" value="Việt Nam">
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label">Ngày sinh / DOB <span class="text-danger">*</span></label>
                        <input type="date" class="form-control" name="ngay_sinh" required>
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label">Nơi sinh / Place of Birth</label>
                        <input type="text" class="form-control" name="noi_sinh">
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label">Số điện thoại / Phone <span class="text-danger">*</span></label>
                        <input type="tel" class="form-control" name="so_dien_thoai" required>
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label">Email cá nhân / Personal Email <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label">Tình trạng hôn nhân / Marital Status</label>
                        <select class="form-select" name="hon_nhan">
                            <option value="Độc thân">Độc thân / Single</option>
                            <option value="Đã kết hôn">Đã kết hôn / Married</option>
                            <option value="Ly hôn">Ly hôn / Divorced</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Địa chỉ thường trú / Permanent Address</label>
                        <input type="text" class="form-control" name="dia_chi_thuong_tru">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Nơi ở hiện tại / Current Address</label>
                        <input type="text" class="form-control" name="noi_o_hien_tai">
                    </div>
                </div>

                <div class="section-header">2. Giấy tờ tùy thân / ID Card</div>
                <div class="row g-3">
                    <div class="col-12 col-md-4">
                        <label class="form-label">Số CCCD / ID Number <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" name="so_cccd" required>
                    </div>
                    <div class="col-6 col-md-4">
                        <label class="form-label">Ngày Cấp / Date of Issue</label>
                        <input type="date" class="form-control" name="ngay_cap_cccd">
                    </div>
                    <div class="col-6 col-md-4">
                        <label class="form-label">Nơi cấp / Place of Issue</label>
                        <input type="text" class="form-control" name="noi_cap_cccd">
                    </div>
                </div>

                <div class="section-header">3. Trình độ học vấn / Education</div>
                <div class="row g-3">
                    <div class="col-12 col-md-4">
                        <label class="form-label">Trình độ cao nhất / Highest Degree</label>
                        <select class="form-select" name="trinh_do">
                            <option value="Đại học">Đại học / Bachelor</option>
                            <option value="Cao đẳng">Cao đẳng / College</option>
                            <option value="Thạc Sỹ">Thạc Sỹ / Master</option>
                            <option value="Tiến Sỹ">Tiến Sỹ / PhD</option>
                            <option value="Khác">Khác / Other</option>
                        </select>
                    </div>
                    <div class="col-12 col-md-4">
                        <label class="form-label">Chuyên ngành / Major</label>
                        <input type="text" class="form-control" name="chuyen_nganh">
                    </div>
                    <div class="col-12 col-md-4">
                        <label class="form-label">Trường đào tạo / University</label>
                        <input type="text" class="form-control" name="truong_dao_tao">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Bằng cấp khác (nếu có) / Other Certificates</label>
                        <input type="text" class="form-control" name="bang_cap_khac">
                    </div>
                </div>

                <div class="section-header">4. Tài chính & Pháp lý / Finance & Legal</div>
                <div class="row g-3">
                    <div class="col-12 col-md-4">
                        <label class="form-label">Tên chủ tài khoản / Account Holder</label>
                        <input type="text" class="form-control" name="ten_tk_ngan_hang" style="text-transform: uppercase;">
                    </div>
                    <div class="col-12 col-md-4">
                        <label class="form-label">Số tài khoản / Account Number</label>
                        <input type="text" class="form-control" name="so_tk_ngan_hang">
                    </div>
                    <div class="col-12 col-md-4">
                        <label class="form-label">Ngân hàng - Chi nhánh / Bank - Branch</label>
                        <input type="text" class="form-control" name="chi_nhanh_ngan_hang" placeholder="VD: VCB - CN Ba Đình">
                    </div>
                    <div class="col-12 col-md-4">
                        <label class="form-label">Mã số thuế cá nhân / Tax Code</label>
                        <input type="text" class="form-control" name="mst_ca_nhan">
                    </div>
                    <div class="col-6 col-md-4">
                        <label class="form-label">Nơi cấp MST / Tax Place</label>
                        <input type="text" class="form-control" name="noi_cap_mst">
                    </div>
                    <div class="col-6 col-md-4">
                        <label class="form-label">Ngày cấp MST / Tax Date</label>
                        <input type="date" class="form-control" name="ngay_cap_mst">
                    </div>
                    <div class="col-12">
                        <label class="form-label">Số sổ BHXH (Nếu có) / Social Insurance No</label>
                        <input type="text" class="form-control" name="so_bhxh" placeholder="Giảng viên thỉnh giảng bỏ qua / Visiting Lecturers skip this">
                    </div>
                </div>

                <div class="section-header">5. Gia đình / Family</div>
                <div class="mb-3">
                    <label class="form-label text-primary fw-bold">Thông tin con (Họ tên - Ngày sinh) / Children Info</label>
                    <div class="row g-2">
                        <div class="col-12"><input type="text" class="form-control" name="con_1" placeholder="Con/Child 1 (Name - DOB)"></div>
                        <div class="col-12"><input type="text" class="form-control" name="con_2" placeholder="Con/Child 2 (Name - DOB)"></div>
                        <div class="col-12"><input type="text" class="form-control" name="con_3" placeholder="Con/Child 3 (Name - DOB)"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                     <label class="form-label text-primary fw-bold">Người phụ thuộc (Giảm trừ gia cảnh) / Dependents</label>
                     <div class="card p-2 bg-light mb-2">
                        <div class="row g-2">
                            <div class="col-12"><input type="text" class="form-control form-control-sm" name="npt_1_ten" placeholder="Họ tên NPT 1 / Name 1"></div>
                            <div class="col-6"><input type="text" class="form-control form-control-sm" name="npt_1_mst" placeholder="MST / Tax Code"></div>
                            <div class="col-6"><input type="text" class="form-control form-control-sm" name="npt_1_qh" placeholder="Quan hệ / Relation"></div>
                        </div>
                     </div>
                     <div class="card p-2 bg-light">
                        <div class="row g-2">
                            <div class="col-12"><input type="text" class="form-control form-control-sm" name="npt_2_ten" placeholder="Họ tên NPT 2 / Name 2"></div>
                            <div class="col-6"><input type="text" class="form-control form-control-sm" name="npt_2_mst" placeholder="MST / Tax Code"></div>
                            <div class="col-6"><input type="text" class="form-control form-control-sm" name="npt_2_qh" placeholder="Quan hệ / Relation"></div>
                        </div>
                     </div>
                </div>

                <div class="col-12">
                    <label class="form-label text-danger fw-bold">Liên hệ khẩn cấp / Emergency Contact <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" name="lien_he_khan_cap" placeholder="Tên - SĐT - Mối quan hệ / Name - Phone - Relation" required>
                </div>

                <div class="section-header">6. Công việc & Hồ sơ / Job & Docs</div>
                <div class="row g-3">
                    <div class="col-12 col-md-6">
                        <label class="form-label">Loại hợp đồng / Contract Type</label>
                        <select class="form-select" name="loai_hop_dong" id="contractType" onchange="checkContractType()">
                            <option value="Hợp đồng thỉnh giảng">Hợp đồng thỉnh giảng / Visiting Contract</option>
                            <option value="Hợp đồng dịch vụ">Hợp đồng dịch vụ / Servives Contract</option>
                            <option value="Khác">Khác / Other</option>
                        </select>
                        <input type="text" class="form-control mt-2 d-none" name="loai_hop_dong_khac" id="otherContract" placeholder="Nhập loại hợp đồng / Type here...">
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label">Phòng ban / Department</label>
                        <select class="form-select" name="phong_ban">
                            <option value="Phòng NSVH">Phòng NSVH / HR & Admin</option>
                            <option value="Phòng MKT">Phòng MKT / Marketing</option>
                            <option value="Phòng Kinh doanh">Phòng Kinh doanh / Sales</option>
                            <option value="Phòng Đào tạo">Phòng Đào tạo / Training</option>
                            <option value="Ban Lãnh Đạo">Ban Lãnh Đạo / Board of Management</option>
                            <option value="Phòng Tuyển sinh">Phòng Tuyển sinh / Admissions</option>
                            <option value="Phòng Kế toán">Phòng Kế toán / Accounting</option>
                            <option value="Thư ký khoa">Thư ký khoa / Faculty Secretary</option>
                            <option value="Khoa CH">Khoa CH / CH Faculty</option>
                            <option value="Khoa BCH">Khoa BCH / BCH Faculty</option>
                        </select>
                    </div>
                    
                    <div class="col-12 mt-4">
                        <div class="p-3 border border-primary border-2 border-dashed rounded text-center bg-white">
                            <label class="form-label fw-bold mb-2 text-primary">Ảnh hồ sơ cá nhân / Photos (Tối đa 5 ảnh / Max 5) <span class="text-danger">*</span></label>
                            <input type="file" class="form-control" id="fileInput" multiple accept="image/*" required>
                            <small class="text-muted d-block mt-2">Hệ thống sẽ tự tạo thư mục mang tên bạn / System will auto-create a folder with your name.</small>
                        </div>
                    </div>
                </div>

                <div class="btn-submit-wrapper">
                    <button type="button" class="btn btn-primary btn-submit" id="btnSubmit" onclick="submitForm()">GỬI HỒ SƠ / SUBMIT PROFILE</button>
                </div>

            </form>
        </div>
    </div>

    <div id="loadingOverlay" class="loading-overlay d-none">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
        <h5 class="mt-3 text-primary" id="loadingText">Đang xử lý dữ liệu...</h5>
        <p class="text-muted small">Vui lòng không tắt trình duyệt / Please do not close browser.</p>
    </div>
<div class="text-center mt-4 mb-5">
        <small class="text-muted" style="font-size: 0.75rem; opacity: 0.6;">
            &copy; 2025 APCHN HR System. All rights reserved. <br>
            <a href="./admin.html" class="text-decoration-none text-secondary hover-primary">
                <i class="bi bi-shield-lock"></i> Quản trị viên (Admin Portal)
            </a>
        </small>
</div>
    <script>
        // LINK APP SCRIPT CỦA BẠN (Đã kiểm tra: Chính xác)
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyYEMo7vTqnNV2TvI-PMp1uDeOu_Yk1HFADlD_6J5wyrmvzZ9YlPcocxU7bajR4ebqMow/exec";

        function checkContractType() {
            const select = document.getElementById('contractType');
            const otherInput = document.getElementById('otherContract');
            if (select.value === 'Khác') {
                otherInput.classList.remove('d-none');
                otherInput.required = true;
            } else {
                otherInput.classList.add('d-none');
                otherInput.required = false;
            }
        }

        function submitForm() {
            const form = document.getElementById('hrForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            loadingOverlay.classList.remove('d-none');
            loadingText.innerText = "Đang kết nối Server... (Connecting...)";

            const formData = new FormData(form);
            const dataObj = {};
            formData.forEach((value, key) => {
                if(key !== 'images') dataObj[key] = value;
            });

            // Gửi dữ liệu Text
            fetch(SCRIPT_URL, {
                method: "POST",
                redirect: "follow",
                headers: {
                    "Content-Type": "text/plain;charset=utf-8"
                },
                body: JSON.stringify({ action: "SAVE_INFO", payload: dataObj })
            })
            .then(response => response.json()) 
            .then(response => {
                if (response.status === 'SUCCESS') {
                    loadingText.innerText = "Đang lưu ảnh... (Uploading photos...)";
                    uploadPhotos(response.folderId);
                } else {
                    throw new Error(response.message || "Unknown Error");
                }
            })
            .catch(error => {
                console.error(error);
                if (error instanceof SyntaxError) {
                    alert("Lỗi kết nối / Connection Error. Check permissions.");
                } else {
                    alert('Lỗi: ' + error.message);
                }
                loadingOverlay.classList.add('d-none');
            });
        }

        async function uploadPhotos(folderId) {
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;
            const loadingText = document.getElementById('loadingText');

            if (files.length === 0) {
                finishSubmission();
                return;
            }

            let uploadedCount = 0;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                loadingText.innerText = `Uploading image ${i + 1}/${files.length}...`;
                try {
                    const base64Data = await convertToBase64(file);
                    await fetch(SCRIPT_URL, {
                        method: "POST",
                        redirect: "follow",
                        headers: { "Content-Type": "text/plain;charset=utf-8" },
                        body: JSON.stringify({ 
                            action: "UPLOAD_FILE", 
                            payload: { folderId: folderId, fileName: file.name, dataStr: base64Data }
                        })
                    });
                    uploadedCount++;
                } catch (err) {
                    console.error("Upload error: ", file.name, err);
                }
            }
            finishSubmission();
        }

        function convertToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function finishSubmission() {
            document.getElementById('loadingOverlay').classList.add('d-none');
            alert("✅ XONG! Hồ sơ đã được gửi thành công / Submission Successful.");
            document.getElementById('hrForm').reset();
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html>
