<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tra C·ª©u Nh√¢n S·ª± (Auto Detect)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; background-color: #f0f2f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #1a1a1a; margin-bottom: 20px; }
        
        /* √î t√¨m ki·∫øm */
        input { padding: 15px; width: 100%; box-sizing: border-box; font-size: 16px; border: 2px solid #ddd; border-radius: 8px; transition: 0.3s; }
        input:focus { border-color: #007bff; outline: none; box-shadow: 0 0 0 3px rgba(0,123,255,0.1); }
        
        /* Tr·∫°ng th√°i */
        #status { margin-bottom: 15px; font-weight: 500; font-size: 14px; text-align: center; }
        
        /* Danh s√°ch k·∫øt qu·∫£ */
        #resultList { margin-top: 10px; border: 1px solid #eee; border-radius: 8px; overflow: hidden; display: none; }
        .item { padding: 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; background: white; transition: 0.2s; display: flex; justify-content: space-between; align-items: center; }
        .item:hover { background-color: #f7f9fc; }
        .item strong { color: #333; font-size: 16px; }
        .item span { color: #666; font-size: 14px; }
        .item:last-child { border-bottom: none; }

        /* H·ªôp Debug (M√†u v√†ng) */
        #debug-box { font-size: 12px; background: #fff3cd; color: #856404; padding: 10px; margin-top: 15px; border-radius: 6px; display: none; border: 1px solid #ffeeba; }

        /* Chi ti·∫øt */
        #detail-area { background: #e8f5e9; padding: 20px; display: none; margin-top: 20px; border-radius: 8px; border: 1px solid #c3e6cb; }
        .d-row { margin-bottom: 10px; border-bottom: 1px dashed #a5d6a7; padding-bottom: 5px; }
        .d-label { font-weight: bold; width: 130px; display: inline-block; color: #2e7d32; }
    </style>
</head>
<body>

<div class="container">
    <h2>üîç TRA C·ª®U NH√ÇN S·ª∞</h2>
    <div id="status" style="color:orange">‚è≥ ƒêang k·∫øt n·ªëi...</div>

    <input type="text" id="searchInp" placeholder="Nh·∫≠p t√™n ƒë·ªÉ t√¨m..." disabled>
    
    <div id="resultList"></div>

    <div id="detail-area">
        <h3 style="margin-top:0">‚úÖ Th√¥ng tin h·ªì s∆°:</h3>
        <div class="d-row"><span class="d-label">H·ªç v√† T√™n:</span> <span id="out_name"></span></div>
        <div class="d-row"><span class="d-label">Email:</span> <span id="out_email"></span></div>
        <div class="d-row"><span class="d-label">ƒêi·ªán tho·∫°i:</span> <span id="out_phone"></span></div>
        <div class="d-row"><span class="d-label">H·ª£p ƒë·ªìng:</span> <span id="out_contract"></span></div>
    </div>

    <div id="debug-box"></div>
</div>

<script>
    // üî¥ LINK API C·ª¶A B·∫†N
    const API_URL = "https://apchn-host.lapage.vn/webhook/api-get-candidates"; 

    // Bi·∫øn to√†n c·ª•c
    let database = []; 
    let COL_NAME = "";  // T·ª± ƒë·ªông l∆∞u t√™n c·ªôt T√™n
    let COL_EMAIL = ""; // T·ª± ƒë·ªông l∆∞u t√™n c·ªôt Email

    const statusDiv = document.getElementById('status');
    const searchInp = document.getElementById('searchInp');
    const resultList = document.getElementById('resultList');
    const detailArea = document.getElementById('detail-area');
    const debugBox = document.getElementById('debug-box');

    // --- 1. T·∫¢I D·ªÆ LI·ªÜU ---
    fetch(API_URL)
        .then(response => response.json())
        .then(data => {
            // X·ª≠ l√Ω d·ªØ li·ªáu th√¥
            let rawData = [];
            if (Array.isArray(data)) rawData = data;
            else if (data.data && Array.isArray(data.data)) rawData = data.data;
            else rawData = [data];

            database = rawData.map(item => item.json ? item.json : item);

            if (database.length > 0) {
                // üî• THU·∫¨T TO√ÅN T·ª∞ ƒê·ªòNG B·∫ÆT C·ªòT (AUTO DETECT) üî•
                const keys = Object.keys(database[0]);
                
                // T√¨m c·ªôt T√™n: C·ªôt n√†o ch·ª©a ch·ªØ "Name" ho·∫∑c "H·ªç v√† T√™n"
                COL_NAME = keys.find(k => k.toLowerCase().includes("name") || k.toLowerCase().includes("h·ªç v√† t√™n"));
                if (!COL_NAME) COL_NAME = keys[1]; // N·∫øu ko t√¨m th·∫•y, l·∫•y t·∫°m c·ªôt th·ª© 2
                
                // T√¨m c·ªôt Email: C·ªôt n√†o ch·ª©a ch·ªØ "Email"
                COL_EMAIL = keys.find(k => k.toLowerCase().includes("email"));

                // Th√¥ng b√°o tr·∫°ng th√°i
                statusDiv.innerText = `‚úÖ ƒê√£ t·∫£i ${database.length} h·ªì s∆°. S·∫µn s√†ng!`;
                statusDiv.style.color = "green";
                searchInp.disabled = false;
                searchInp.focus();

                // Hi·ªán debug ƒë·ªÉ b·∫°n ki·ªÉm tra
                debugBox.style.display = 'block';
                debugBox.innerHTML = `
                    <strong>üîß DEBUG T·ª∞ ƒê·ªòNG:</strong><br>
                    - C·ªôt T√™n ƒëang l·∫•y l√†: <code>[${COL_NAME}]</code><br>
                    - C·ªôt Email ƒëang l·∫•y l√†: <code>[${COL_EMAIL}]</code>
                `;
            } else {
                statusDiv.innerText = "‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu.";
            }
        })
        .catch(err => {
            statusDiv.innerText = "‚ùå L·ªói: " + err.message;
        });

    // --- 2. T√åM KI·∫æM ---
    searchInp.addEventListener('input', function() {
        const keyword = this.value.toLowerCase().trim();
        resultList.innerHTML = ''; 
        detailArea.style.display = 'none';

        if (keyword.length < 1) {
            resultList.style.display = 'none';
            return;
        }

        // L·ªçc d·ªØ li·ªáu: CH·ªà T√åM THEO C·ªòT T√äN (COL_NAME)
        const ketQua = database.filter(dong => {
            const ten = dong[COL_NAME] || ''; 
            return ten.toLowerCase().includes(keyword);
        });

        resultList.style.display = 'block';

        if (ketQua.length === 0) {
            resultList.innerHTML = '<div style="padding:15px; color:gray; text-align:center">Kh√¥ng t√¨m th·∫•y ai...</div>';
        } else {
            ketQua.forEach(nguoi => {
                const div = document.createElement('div');
                div.className = 'item';
                
                // HI·ªÇN TH·ªä K·∫æT QU·∫¢ T√åM KI·∫æM
                // S·ª≠ d·ª•ng ƒë√∫ng bi·∫øn COL_NAME v√† COL_EMAIL ƒë√£ t√¨m ƒë∆∞·ª£c ·ªü tr√™n
                const hienThiTen = nguoi[COL_NAME] || 'Ch∆∞a r√µ t√™n';
                const hienThiEmail = nguoi[COL_EMAIL] || '';

                div.innerHTML = `<strong>${hienThiTen}</strong> <span>${hienThiEmail}</span>`;
                
                div.onclick = () => hienThiChiTiet(nguoi);
                resultList.appendChild(div);
            });
        }
    });

    // --- 3. HI·ªÇN TH·ªä CHI TI·∫æT ---
    function hienThiChiTiet(nguoi) {
        detailArea.style.display = 'block';
        resultList.style.display = 'none'; // ·∫®n list g·ª£i √Ω
        searchInp.value = ''; // X√≥a √¥ t√¨m

        document.getElementById('out_name').innerText = nguoi[COL_NAME] || '';
        document.getElementById('out_email').innerText = nguoi[COL_EMAIL] || '';
        
        // C√°c tr∆∞·ªùng kh√°c v·∫´n c·∫ßn l·∫•y t∆∞∆°ng ƒë·ªëi, ho·∫∑c d√πng tay n·∫øu c·∫ßn ch√≠nh x√°c
        // T√¥i d√πng logic t√¨m t·ª´ kh√≥a cho c√°c tr∆∞·ªùng n√†y lu√¥n ƒë·ªÉ h·∫°n ch·∫ø l·ªói
        const keys = Object.keys(nguoi);
        
        const phoneKey = keys.find(k => k.toLowerCase().includes("phone") || k.toLowerCase().includes("ƒëi·ªán tho·∫°i")) || 'S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá/ Phone number';
        document.getElementById('out_phone').innerText = nguoi[phoneKey] || '';

        const contractKey = keys.find(k => k.toLowerCase().includes("contract") || k.toLowerCase().includes("h·ª£p ƒë·ªìng")) || 'Lo·∫°i H·ª£p ƒê·ªìng';
        document.getElementById('out_contract').innerText = nguoi[contractKey] || '';
    }
</script>

</body>
</html>
