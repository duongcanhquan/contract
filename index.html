<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Test T√¨m Ki·∫øm D·ªØ Li·ªáu</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .box { border: 1px solid #ccc; padding: 20px; margin-top: 10px; }
        input { padding: 10px; width: 300px; font-size: 16px; }
        #status { font-weight: bold; color: blue; margin-bottom: 10px; }
        .item { padding: 5px; border-bottom: 1px dashed #ddd; cursor: pointer; }
        .item:hover { background-color: #f0f0f0; color: blue; }
        
        /* Khu v·ª±c hi·ªÉn th·ªã chi ti·∫øt sau khi ch·ªçn */
        #detail-area { background: #e8f5e9; padding: 15px; display: none; margin-top: 20px; border: 1px solid green; }
    </style>
</head>
<body>

    <h2>üõ†Ô∏è C√îNG C·ª§ TEST T√åM KI·∫æM D·ªÆ LI·ªÜU</h2>
    
    <div id="status">ƒêang k·∫øt n·ªëi t·ªõi N8N...</div>

    <input type="text" id="searchInp" placeholder="G√µ t√™n ƒë·ªÉ t√¨m ki·∫øm..." disabled>

    <div id="resultList" class="box"></div>

    <div id="detail-area">
        <h3>‚úÖ D·ªØ li·ªáu l·∫•y ƒë∆∞·ª£c c·ªßa ng∆∞·ªùi n√†y:</h3>
        <p><strong>H·ªç t√™n:</strong> <span id="out_name"></span></p>
        <p><strong>Email:</strong> <span id="out_email"></span></p>
        <p><strong>SƒêT:</strong> <span id="out_phone"></span></p>
        <p><strong>CMND:</strong> <span id="out_cmnd"></span></p>
    </div>

    <script>
        // üî¥ B·∫†N D√ÅN LINK C·ª¶A B·∫†N V√ÄO ƒê√ÇY NH√â:
        const API_URL = "https://apchn-host.lapage.vn/webhook/api-get-candidates"; 

        let database = []; // Bi·∫øn ch·ª©a to√†n b·ªô d·ªØ li·ªáu t·ª´ Google Sheet
        const statusDiv = document.getElementById('status');
        const searchInp = document.getElementById('searchInp');
        const resultList = document.getElementById('resultList');
        const detailArea = document.getElementById('detail-area');

        // 1. KHI M·ªû FILE L√äN -> T·ª∞ ƒê·ªòNG G·ªåI N8N ƒê·ªÇ L·∫§Y DATA
        fetch(API_URL)
            .then(response => response.json())
            .then(data => {
                // X·ª≠ l√Ω d·ªØ li·ªáu tr·∫£ v·ªÅ (C√≥ th·ªÉ N8N tr·∫£ v·ªÅ d·∫°ng {data: []} ho·∫∑c [])
                if(Array.isArray(data)) {
                    database = data;
                } else if (data.data) {
                    database = data.data;
                }
                
                statusDiv.innerText = `‚úÖ ƒê√£ t·∫£i xong ${database.length} d√≤ng d·ªØ li·ªáu! H√£y g√µ t√¨m ki·∫øm.`;
                statusDiv.style.color = "green";
                searchInp.disabled = false; // M·ªü kh√≥a √¥ nh·∫≠p
                searchInp.focus();
                
                // In th·ª≠ d·ªØ li·ªáu ra Console cho b·∫°n xem (nh·∫•n F12 ƒë·ªÉ th·∫•y)
                console.log("D·ªØ li·ªáu g·ªëc:", database);
            })
            .catch(err => {
                statusDiv.innerText = "‚ùå L·ªói: Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu. Ki·ªÉm tra l·∫°i Link ho·∫∑c Header CORS tr√™n N8N.";
                statusDiv.style.color = "red";
                console.error(err);
            });

        // 2. L·∫ÆNG NGHE S·ª∞ KI·ªÜN G√ï PH√çM (T√åM KI·∫æM)
        searchInp.addEventListener('input', function() {
            const keyword = this.value.toLowerCase();
            resultList.innerHTML = ''; // X√≥a k·∫øt qu·∫£ c≈©
            detailArea.style.display = 'none'; // ·∫®n chi ti·∫øt c≈©

            if (keyword.length < 1) return;

            // L·ªçc d·ªØ li·ªáu (S·ª≠ d·ª•ng ƒë√∫ng t√™n c·ªôt trong Google Sheet c·ªßa b·∫°n)
      // L·ªçc d·ªØ li·ªáu (C√°ch m·ªõi: T√¨m b·∫•t k·ª≥ c·ªôt n√†o c≈©ng ƒë∆∞·ª£c)
const ketQua = database.filter(dong => {
    // L·∫•y t·∫•t c·∫£ gi√° tr·ªã c·ªßa d√≤ng ƒë√≥ g·ªôp l·∫°i th√†nh chu·ªói ƒë·ªÉ t√¨m
    const toanBoDong = Object.values(dong).join(' ').toLowerCase();
    return toanBoDong.includes(keyword);
});

            // Hi·ªÉn th·ªã danh s√°ch k·∫øt qu·∫£
            if (ketQua.length === 0) {
                resultList.innerHTML = '<div style="color:gray">Kh√¥ng t√¨m th·∫•y ai...</div>';
            } else {
                ketQua.forEach(nguoi => {
                    const div = document.createElement('div');
                    div.className = 'item';
                    div.innerText = `üë§ ${nguoi['H·ªç v√† T√™n/ Name']} - üìß ${nguoi['Email c√° nh√¢n/ Email']}`;
                    
                    // Khi b·∫•m v√†o 1 ng∆∞·ªùi -> Hi·ªán chi ti·∫øt
                    div.onclick = () => hienThiChiTiet(nguoi);
                    
                    resultList.appendChild(div);
                });
            }
        });

        // 3. H√ÄM HI·ªÇN TH·ªä CHI TI·∫æT
        function hienThiChiTiet(nguoi) {
            detailArea.style.display = 'block';
            
            // ƒê∆∞a d·ªØ li·ªáu v√†o HTML
            document.getElementById('out_name').innerText = nguoi['H·ªç v√† T√™n/ Name'];
            document.getElementById('out_email').innerText = nguoi['Email c√° nh√¢n/ Email'];
            document.getElementById('out_phone').innerText = nguoi['S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá/ Phone number'];
            document.getElementById('out_cmnd').innerText = nguoi['S·ªë CMND/ ID'];
        }
    </script>

</body>
</html>
